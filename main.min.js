$(function(){new Promise(function(e,n){navigator.geolocation.getCurrentPosition(function(t){e({long:t.coords.longitude,lat:t.coords.latitude})},function t(e){n(t)},{enableHighAccuracy:!1,timeout:1e4})}).then(function(t){return i=t.long,a=t.lat,new Promise(function(e,n){$.ajax({url:"https://api.openweathermap.org/data/2.5/forecast?lat="+a+"&lon="+i+"&APPID=07058267c1cec4b93fc211bfba813c79"}).done(function(t){e(t)}).fail(function(t){n(t)})});var i,a}).then(function(t){var o,e,c,n,r;n=o=t,r=[],$.each(n.list,function(t,e){var n=new Date(e.dt_txt);n=n.setHours(0,0,0,0);var i=r.find(function(t){return t.newDate==n});if(i)i.times.push(e);else{var a={newDate:n,times:[e]};r.push(a)}}),e=r,c="",$.each(e,function(t,e){var n=new Date(e.newDate),i=n.getDate(),a=n.getMonth()+1;c="<h3>Число: "+i+" Месяц: "+a+"</h3><div><div class='cityName'>"+o.city.name+" "+o.city.country+"</div><ul class='weatherParam'>",$.each(e.times,function(t,e){var n=moment(e.dt_txt).format("HH:mm:ss");c=c+"<li><ul class='wheatherItems'><li><img src='http://openweathermap.org/img/w/"+e.weather[0].icon+".png' alt='"+e.weather[0].description+"'></li><li>T макс: "+(e.main.temp_max-273.15+" ").substring(0,4)+" C</li><li>T мин: "+(e.main.temp_min-273.15+" ").substring(0,4)+" C</li><li>Давление: "+(e.main.pressure/1e3+" ").substring(0,5)+" бар<li>Часы: "+n+"</li></ul></li>"}),c+="</ul></div></div>",$("#accordion").append(c)}),$("#accordion").accordion({heightStyle:"content",collapsible:!0}),console.log(t)}).catch(function(t){console.log(alert(t.message+" "+t.code))})});